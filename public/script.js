/*! For license information please see script.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.hikrcdn=e():t.hikrcdn=e()}(this,(()=>(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function o(){var t=f(),e=t.m(o),n=(Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__).constructor;function r(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===n||"GeneratorFunction"===(e.displayName||e.name))}var l={throw:1,return:2,break:3,continue:3};function d(t){var e,n;return function(r){e||(e={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(t,e){return n(r.a,l[t],e)},delegateYield:function(t,o,a){return e.resultName=o,n(r.d,i(t),a)},finish:function(t){return n(r.f,t)}},n=function(t,n,o){r.p=e.prev,r.n=e.next;try{return t(n,o)}finally{e.next=r.n}}),e.resultName&&(e[e.resultName]=r.v,e.resultName=void 0),e.sent=r.v,e.next=r.n;try{return t.call(this,e)}finally{r.p=e.prev,r.n=e.next}}}return(o=function(){return{wrap:function(e,n,r,o){return t.w(d(e),n,r,o&&o.reverse())},isGeneratorFunction:r,mark:t.m,awrap:function(t,e){return new p(t,e)},AsyncIterator:s,async:function(t,e,n,o,i){return(r(e)?c:u)(d(t),e,n,o,i)},keys:a,values:i}})()}function i(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}throw new TypeError(n(t)+" is not iterable")}function a(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}}function u(t,e,n,r,o){var i=c(t,e,n,r,o);return i.next().then((function(t){return t.done?t.value:i.next()}))}function c(t,e,n,r,o){return new s(f().w(t,e,n,r),o||Promise)}function s(t,e){function n(r,o,i,a){try{var u=t[r](o),c=u.value;return c instanceof p?e.resolve(c.v).then((function(t){n("next",t,i,a)}),(function(t){n("throw",t,i,a)})):e.resolve(c).then((function(t){u.value=t,i(u)}),(function(t){return n("throw",t,i,a)}))}catch(t){a(t)}}var r;this.next||(l(s.prototype),l(s.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",(function(){return this}))),l(this,"_invoke",(function(t,o,i){function a(){return new e((function(e,r){n(t,i,e,r)}))}return r=r?r.then(a,a):a()}),!0)}function f(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var c=r&&r.prototype instanceof u?r:u,s=Object.create(c.prototype);return l(s,"_invoke",function(n,r,o){var i,u,c,s=0,f=o||[],l=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,u=0,c=t,p.n=n,a}};function d(n,r){for(u=n,c=r,e=0;!l&&s&&!o&&e<f.length;e++){var o,i=f[e],d=p.p,v=i[2];n>3?(o=v===r)&&(c=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=n<2&&d<i[1])?(u=0,p.v=r,p.n=i[1]):d<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,p.n=v,u=0))}if(o||n>1)return a;throw l=!0,r}return function(o,f,v){if(s>1)throw TypeError("Generator is already running");for(l&&1===f&&d(f,v),u=f,c=v;(e=u<2?t:c)||!l;){i||(u?u<3?(u>1&&(p.n=-1),d(u,c)):p.n=c:p.v=c);try{if(s=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(l=p.n<0)?c:n.call(r,p))!==a)break}catch(e){i=t,u=1,c=e}finally{s=1}}return{value:e,done:l}}}(n,o,i),!0),s}var a={};function u(){}function c(){}function s(){}e=Object.getPrototypeOf;var p=[][r]?e(e([][r]())):(l(e={},r,(function(){return this})),e),d=s.prototype=u.prototype=Object.create(p);function v(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,l(t,o,"GeneratorFunction")),t.prototype=Object.create(d),t}return c.prototype=s,l(d,"constructor",s),l(s,"constructor",c),c.displayName="GeneratorFunction",l(s,o,"GeneratorFunction"),l(d),l(d,o,"Generator"),l(d,r,(function(){return this})),l(d,"toString",(function(){return"[object Generator]"})),(f=function(){return{w:i,m:v}})()}function l(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}l=function(t,e,n,r){function i(e,n){l(t,e,(function(t){return this._invoke(e,n,t)}))}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},l(t,e,n,r)}function p(t,e){this.v=t,this.k=e}function d(t,e,n,r,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void n(t)}u.done?e(c):Promise.resolve(c).then(r,o)}function v(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){d(i,r,o,a,u,"next",t)}function u(t){d(i,r,o,a,u,"throw",t)}a(void 0)}))}}function y(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,h(r.key),r)}}function h(t){var e=function(t){if("object"!=n(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==n(e)?e:e+""}t.r(e),t.d(e,{hikr:()=>w});var m,b,g,w=function(){return t=function t(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.profileHistoryId=e&&localStorage.getItem("history")||void 0,this.userConsent=e},e=[{key:"saveToLocalStorage",value:function(t){for(var e in t)t.hasOwnProperty(e)&&localStorage.setItem(e,t[e])}},{key:"config",value:(s=v(o().mark((function t(e){var n,r,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.websiteId,r=e.userConsent,!(i=void 0===r||r)){t.next=11;break}if(this.readCookie("bp_user",i)){t.next=8;break}return t.next=6,this.createUser(n,i);case 6:t.next=11;break;case 8:return this.setupEventListeners(n,i),t.next=11,this.onPageLoadOrURLChange(n,i);case 11:case"end":return t.stop()}}),t,this)}))),function(t){return s.apply(this,arguments)})},{key:"createCookie",value:function(t,e,n){n&&(console.log("Setting cookie: ".concat(t,"=").concat(e)),document.cookie="".concat(t,"=").concat(e,"; expires=").concat(this.getCookieExpirationDate(),"; path=/"))}},{key:"readCookie",value:function(t,e){if(!e)return null;var n,o="".concat(t,"="),i=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return r(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var o=0,i=function(){};return{s:i,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,u=!0,c=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return u=t.done,t},e:function(t){c=!0,a=t},f:function(){try{u||null==n.return||n.return()}finally{if(c)throw a}}}}(decodeURIComponent(document.cookie).split(";"));try{for(i.s();!(n=i.n()).done;){var a=n.value;if(0===(a=a.trim()).indexOf(o))return a.substring(o.length)}}catch(t){i.e(t)}finally{i.f()}return null}},{key:"createUser",value:(c=v(o().mark((function t(e,n){var r,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=2;break}return t.abrupt("return");case 2:return r={websiteId:e,source:this.getQueryParam("utm_source"),medium:this.getQueryParam("utm_medium"),fbclid:this.getQueryParam("fbclid")||"af729247-f598-4272-ab4a-95a2f25d4624",campaignUrl:this.getQueryParam("utm_campaign")},t.next=5,this.apiCall("profile",r);case 5:return i=t.sent,console.log("User data received:",i),i&&i.userId?(this.createCookie("bp_user",i.userId,n),console.log("Created bp_user cookie with value: ".concat(i.userId))):console.error("No userId found in user data."),t.next=10,this.onPageLoadOrURLChange(e,n);case 10:case"end":return t.stop()}}),t,this)}))),function(t,e){return c.apply(this,arguments)})},{key:"onPageLoadOrURLChange",value:(u=v(o().mark((function t(e,n){var r,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=2;break}return t.abrupt("return");case 2:if(r=this.readCookie("bp_user",n),console.log("Read bp_user cookie value: ".concat(r)),!r){t.next=9;break}return i={userProfileId:r,pageUrl:window.location.href,pageTitle:document.title,websiteId:e},t.next=8,this.apiCall("profile/history",i);case 8:this.saveToLocalStorage({history:i.userProfileId});case 9:case"end":return t.stop()}}),t,this)}))),function(t,e){return u.apply(this,arguments)})},{key:"setupEventListeners",value:function(t,e){var n=this;if(e&&!this.initialized){this.initialized=!0;var r=document.querySelectorAll("button"),i=document.querySelectorAll("form");r.forEach((function(t){t.addEventListener("click",v(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.handleButtonClick(t);case 2:case"end":return e.stop()}}),e)}))))})),i.forEach((function(t){t.addEventListener("submit",function(){var e=v(o().mark((function e(r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.preventDefault(),e.next=3,n.handleFormSubmit(t);case 3:t.submit();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}))}}},{key:"handleButtonClick",value:(a=v(o().mark((function t(e){var n,r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.readCookie("bp_user",this.userConsent),r={timestamp:(new Date).toISOString(),event:"click",collectionName:"User Info",data:"Button clicked: "+e.innerText,userProfileId:n},t.next=4,this.apiCall("action",r);case 4:case"end":return t.stop()}}),t,this)}))),function(t){return a.apply(this,arguments)})},{key:"handleFormSubmit",value:(i=v(o().mark((function t(e){var n,r,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new FormData(e),r=this.readCookie("bp_user",this.userConsent),i={timestamp:(new Date).toISOString(),event:"submit",collectionName:"User Info",data:JSON.stringify(Array.from(n.entries())),userProfileId:r},t.next=5,this.apiCall("action",i);case 5:case"end":return t.stop()}}),t,this)}))),function(t){return i.apply(this,arguments)})},{key:"pushData",value:function(t){var e=t.eventType,n=t.collectionName,r=t.data,o=t.userConsent;if(o&&this.readCookie("bp_user",o)){this.initialized||this.setupEventListeners(null,o);var i={timestamp:(new Date).toISOString(),event:e||"custom",collectionName:n||"default",data:r||"Default Data"};this.apiCall("action",i)}}},{key:"setupInteractionListeners",value:function(t,e,n,r){var i=this,a=document.querySelectorAll("button"),u=document.querySelectorAll("form");a.forEach((function(a){a.addEventListener("click",v(o().mark((function u(){var c;return o().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return c={timestamp:(new Date).toISOString(),event:t||"click",collectionName:e||"default",data:n||"Button Clicked"},o.next=3,i.apiCall("action",c);case 3:return o.next=5,i.pushData({eventType:"click",collectionName:"userInteractions",data:"Button clicked: "+a.innerText,userConsent:r});case 5:case"end":return o.stop()}}),u)}))))})),u.forEach((function(t){t.addEventListener("submit",function(){var n=v(o().mark((function n(a){var u,c;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return u=new FormData(t),c={timestamp:(new Date).toISOString(),event:"submit",collectionName:e||"default",data:JSON.stringify(Array.from(u.entries()))},n.next=4,i.apiCall("action",c);case 4:return n.next=6,i.pushData({eventType:"submit",collectionName:"userInteractions",data:"Form submitted: "+JSON.stringify(Array.from(u.entries())),userConsent:r});case 6:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}())}))}},{key:"getCookieExpirationDate",value:function(){var t=new Date;return t.setDate(t.getDate()+30),t.toUTCString()}},{key:"getQueryParam",value:function(t){return new URLSearchParams(window.location.search).get(t)}},{key:"apiCall",value:(n=v(o().mark((function t(e,n){var r,i,a,u=arguments;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=u.length>2&&void 0!==u[2]?u[2]:"POST",i="".concat("http://localhost:4000/api/cdn/v1","/").concat(e),t.next=4,fetch(i,{method:r,headers:{Accept:"application/json","Content-Type":"application/json"},body:"GET"===r?void 0:JSON.stringify(n)});case 4:return a=t.sent,t.abrupt("return",a.json());case 6:case"end":return t.stop()}}),t)}))),function(t,e){return n.apply(this,arguments)})}],e&&y(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,i,a,u,c,s}();return m=w,g=!1,(b=h(b="initialized"))in m?Object.defineProperty(m,b,{value:g,enumerable:!0,configurable:!0,writable:!0}):m[b]=g,"undefined"!=typeof window&&(window.hikr=w),e})()));